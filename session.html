<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Session Details</title>
  <style>
    @font-face {
      font-family: 'Gilroy';
      src: url('https://raw.githubusercontent.com/dept/highway/master/docs/assets/fonts/Gilroy-Regular.woff2') format('woff2');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #1a4d7a;
      --primary-light: #2d6ba3;
      --text: #1a1a1a;
      --text-light: #666;
      --bg: #f8f9fa;
      --white: #ffffff;
      --border: #e0e0e0;
      --radius: 8px;
    }

    body {
      font-family: 'Gilroy', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .back-link {
      display: inline-block;
      margin-bottom: 24px;
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
      transition: color 0.2s;
    }

    .back-link:hover {
      color: var(--primary-light);
    }

    .session-header {
      background: var(--white);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 32px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .session-badge {
      display: inline-block;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 16px;
    }

    .session-badge.plenary {
      background: #e3f2fd;
      color: #1565c0;
    }

    .session-badge.breakout {
      background: #f3e5f5;
      color: #7b1fa2;
    }

    .session-badge.special {
      background: #fff3e0;
      color: #e65100;
    }

    .session-badge.poster {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .session-badge.meal {
      background: #fce4ec;
      color: #c2185b;
    }

    .session-badge.break {
      background: #e3e3e3;
      color: #424242;
    }

    .session-badge.workshop {
      background: #e0f2f1;
      color: #00695c;
    }

    .subcode {
      display: inline-block;
      font-weight: 900;
      letter-spacing: 0.3px;
      padding: 2px 6px;
      border-radius: 6px;
      background: #fff;
      color: #111827;
      border: 1px solid var(--border);
      font-size: 0.72rem;
      margin-left: 6px;
    }

    h1 {
      font-size: 2rem;
      color: var(--primary);
      margin-bottom: 12px;
      line-height: 1.2;
    }

    .session-subtitle {
      font-size: 1.1rem;
      color: var(--text-light);
      font-style: italic;
      margin-bottom: 24px;
    }

    .session-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid var(--border);
    }

    .meta-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .meta-label {
      font-size: 0.85rem;
      color: var(--text-light);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .meta-value {
      font-size: 1rem;
      color: var(--text);
      font-weight: 600;
    }

    .session-content {
      background: var(--white);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 32px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .content-section {
      margin-bottom: 32px;
    }

    .content-section:last-child {
      margin-bottom: 0;
    }

    .content-section h2 {
      font-size: 1.5rem;
      color: var(--primary);
      margin-bottom: 16px;
    }

    .content-section p {
      margin-bottom: 12px;
      color: var(--text);
    }

    .people-list {
      list-style: none;
      padding: 0;
    }

    .people-list li {
      padding: 8px 0;
      border-bottom: 1px solid var(--border);
    }

    .people-list li:last-child {
      border-bottom: none;
    }

    .people-list a {
      color: var(--primary);
      text-decoration: none;
      transition: color 0.2s;
    }

    .people-list a:hover {
      color: var(--primary-light);
      text-decoration: underline;
    }

    .error-message {
      background: #fee;
      border: 1px solid #fcc;
      border-radius: var(--radius);
      padding: 24px;
      text-align: center;
      color: #c33;
    }

    .avatars {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 12px;
    }

    .avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      overflow: hidden;
      position: relative;
      border: 2px solid var(--white);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      transition: all 0.2s ease;
      flex-shrink: 0;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #1a4d7a 0%, #2d6ba3 100%);
      color: white;
      font-weight: 700;
      font-size: 0.85rem;
      text-decoration: none;
    }

    .avatar:hover {
      transform: scale(1.15);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      z-index: 5;
    }

    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Sub-Sessions */
    .sub-sessions-section {
      margin-top: 32px;
    }

    .sub-sessions-section h2 {
      font-size: 1.5rem;
      color: var(--primary);
      margin-bottom: 16px;
    }

    .sub-session-item {
      background: var(--white);
      border: 1px solid var(--border);
      border-left: 4px solid var(--primary);
      border-radius: var(--radius);
      padding: 16px;
      margin-bottom: 12px;
      transition: all 0.2s;
      cursor: pointer;
    }

    .sub-session-item:hover {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transform: translateX(4px);
      border-left-color: var(--primary-light);
    }

    .sub-session-item a {
      color: var(--primary);
      text-decoration: underline;
    }

    .sub-session-item a:hover {
      color: var(--primary-light);
    }

    .sub-session-item-number {
      display: inline-block;
      background: var(--primary);
      color: var(--white);
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 700;
      margin-right: 12px;
      vertical-align: top;
    }

    .sub-session-item-content {
      display: inline-block;
      width: calc(100% - 50px);
      vertical-align: top;
    }

    .sub-session-item-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 8px;
    }

    .sub-session-item-presenter {
      font-size: 0.9rem;
      color: var(--text-light);
    }

    .sub-session-item-presenter a {
      color: var(--primary);
      text-decoration: none;
    }

    .sub-session-item-presenter a:hover {
      text-decoration: underline;
    }

    .sub-session-item-time {
      font-size: 0.85rem;
      color: var(--text-light);
      margin-top: 4px;
    }
  </style>
</head>

<body>
  <div class="container">
    <a href="index.html" class="back-link">← Back to Schedule</a>
    <div id="sessionContent"></div>
  </div>

  <script>
    // Include the full sessions array from index.html
    // This would ideally be loaded from a shared data file, but for now we include it here
    const sessions = [
      // Monday, February 2, 2026 (Day 0 - using 0-index internally if dayTabs relies on it, or update dayTabs logic. Original used Day 0 for Sun, Day 1 for Mon. I will use Day 0 for Mon, Day 1 for Tue)
      {
        id: 'mon-1',
        day: 0,
        date: '2026-02-02',
        start: '08:00',
        end: '08:15',
        type: 'Special',
        title: 'Welcome and Introductions',
        subtitle: 'Lead: Aparna Oltikar',
        moderator: 'Aparna Oltikar',
        speakers: [],
        room: 'Creasy Auditorium'
      },
      {
        id: 'mon-2',
        day: 0,
        date: '2026-02-02',
        start: '08:15',
        end: '09:00',
        type: 'Plenary',
        title: 'Introduction to Global Health Bridge Course at Nuvance Health',
        subtitle: 'Format: Lecture',
        moderator: '',
        speakers: ['Bulat Ziganshin'],
        room: 'Creasy Auditorium'
      },
      {
        id: 'mon-3',
        day: 0,
        date: '2026-02-02',
        start: '09:00',
        end: '10:30',
        type: 'Plenary',
        title: 'Global Public Health: Existential Crises and the Role of the US',
        subtitle: 'Format: Lecture',
        moderator: '',
        speakers: ['Kirk Scirto'],
        room: 'Creasy Auditorium'
      },
      {
        id: 'mon-4',
        day: 0,
        date: '2026-02-02',
        start: '10:30',
        end: '10:45',
        type: 'Break',
        title: 'Break',
        moderator: '',
        speakers: [],
        room: 'Creasy Auditorium'
      },
      {
        id: 'mon-5',
        day: 0,
        date: '2026-02-02',
        start: '10:45',
        end: '12:00',
        type: 'Plenary',
        title: 'Infectious Diseases in the Global South',
        subtitle: 'Format: Presentation, case reports',
        moderator: '',
        speakers: ['Steve Scholand'],
        room: 'Creasy Auditorium'
      },
      {
        id: 'mon-6',
        day: 0,
        date: '2026-02-02',
        start: '12:00',
        end: '12:30',
        type: 'Meal',
        title: 'Lunch Break',
        moderator: '',
        speakers: [],
        room: 'Creasy Auditorium'
      },
      {
        id: 'mon-7',
        day: 0,
        date: '2026-02-02',
        start: '12:30',
        end: '13:30',
        type: 'Plenary',
        title: 'Healthcare in Armenia: Global Perspective and Challenges',
        subtitle: 'Format: Lecture',
        moderator: '',
        speakers: ['Gohar Shahsuvaryan'],
        room: 'Creasy Auditorium'
      },
      {
        id: 'mon-8',
        day: 0,
        date: '2026-02-02',
        start: '13:30',
        end: '14:45',
        type: 'Plenary',
        title: 'Local Global Health: Perspectives from the Chiricahua Community Health Centers in Arizona (tentative title)',
        subtitle: 'Format: Lecture',
        moderator: '',
        speakers: ['Jonathan Melk'],
        room: 'Creasy Auditorium'
      },
      {
        id: 'mon-9',
        day: 0,
        date: '2026-02-02',
        start: '14:45',
        end: '15:00',
        type: 'Break',
        title: 'Break',
        moderator: '',
        speakers: [],
        room: 'Creasy Auditorium'
      },
      {
        id: 'mon-10',
        day: 0,
        date: '2026-02-02',
        start: '15:00',
        end: '16:15',
        type: 'Plenary',
        title: 'Bridging the Gap in Global Mental Health Education Between High- and Low/Middle-Income Countries',
        subtitle: 'Format: Interactive Panel Discussion',
        moderator: 'Charles Herrick',
        speakers: ['Majd Soudan', 'Sabih Rahman', 'Psychiatry Residents from Makerere University'],
        room: 'Creasy Auditorium'
      },
      {
        id: 'mon-11',
        day: 0,
        date: '2026-02-02',
        start: '16:15',
        end: '16:30',
        type: 'Special',
        title: 'Global Health Bridge Group Photo',
        moderator: '',
        speakers: [],
        room: 'Creasy Auditorium'
      },
      {
        id: 'mon-12',
        day: 0,
        date: '2026-02-02',
        start: '16:30',
        end: '18:00',
        type: 'Networking',
        title: 'Global Health Reception, Networking, and Posters',
        moderator: '',
        speakers: [],
        room: 'Robilotti Conference Room'
      },
      // Tuesday, February 3, 2026
      {
        id: 'tue-1',
        day: 1,
        date: '2026-02-03',
        start: '08:00',
        end: '09:15',
        type: 'Plenary',
        title: 'Decolonizing Global Health',
        subtitle: 'Format: Lecture',
        moderator: '',
        speakers: ['Kirk Scirto'],
        room: 'Creasy Auditorium'
      },
      {
        id: 'tue-2',
        day: 1,
        date: '2026-02-03',
        start: '09:15',
        end: '09:30',
        type: 'Break',
        title: 'Break',
        moderator: '',
        speakers: [],
        room: 'Creasy Auditorium'
      },
      {
        id: 'tue-3',
        day: 1,
        date: '2026-02-03',
        start: '09:30',
        end: '11:00',
        type: 'Plenary',
        title: 'Global Health As a Career: Opportunities and Challenges',
        subtitle: 'Format: Interactive Panel Discussion',
        moderator: 'Steve Scholand',
        speakers: ['Gohar Shahsuvaryan', 'Jonathan Melk', 'Jasper Tolarba', 'Kirk Scirto', 'Fiona Makoni'],
        room: 'Creasy Auditorium'
      },
      {
        id: 'tue-4',
        day: 1,
        date: '2026-02-03',
        start: '11:00',
        end: '12:00',
        type: 'Plenary',
        title: 'Healthcare in the Philippines: Global Perspective and Challenges',
        subtitle: 'Format: Lecture',
        moderator: '',
        speakers: ['Jasper Tolarba'],
        room: 'Creasy Auditorium'
      },
      {
        id: 'tue-5',
        day: 1,
        date: '2026-02-03',
        start: '12:00',
        end: '13:30',
        type: 'Meal',
        title: 'Lunch and headshots/photos for residency applications',
        moderator: '',
        speakers: [],
        room: 'Creasy Auditorium'
      },
      {
        id: 'tue-6',
        day: 1,
        date: '2026-02-03',
        start: '13:30',
        end: '14:30',
        type: 'Plenary',
        title: 'Healthcare in Zimbabwe: Global Perspective and Challenges',
        subtitle: 'Format: Virtual Lecture',
        moderator: '',
        speakers: ['Fiona Makoni'],
        room: 'Creasy Auditorium'
      },
      {
        id: 'tue-7',
        day: 1,
        date: '2026-02-03',
        start: '14:30',
        end: '15:30',
        type: 'Plenary',
        title: 'Malaria in Resource-Limited Environments: Diagnosis, Treatment, and Prevention (tentative title)',
        subtitle: 'Format: Presentation, case reports',
        moderator: '',
        speakers: ['Steve Scholand'],
        room: 'Creasy Auditorium'
      },
      {
        id: 'tue-8',
        day: 1,
        date: '2026-02-03',
        start: '15:30',
        end: '15:45',
        type: 'Break',
        title: 'Break',
        moderator: '',
        speakers: [],
        room: 'Creasy Auditorium'
      },
      {
        id: 'tue-9',
        day: 1,
        date: '2026-02-03',
        start: '15:45',
        end: '17:15',
        type: 'Plenary',
        title: 'The Role of Public Health in Addressing Armed Conflict',
        subtitle: 'Format: Lecture',
        moderator: '',
        speakers: ['Kaveh Khoshnood'],
        room: 'Creasy Auditorium'
      },
      {
        id: 'tue-10',
        day: 1,
        date: '2026-02-03',
        start: '17:15',
        end: '17:30',
        type: 'Special',
        title: 'Adjourn Global Health Bridge',
        moderator: '',
        speakers: [],
        room: 'Creasy Auditorium'
      }
    ];

    // Helper functions
    const LABEL_PREFIX = {
      'Plenary': 'PL',
      'Breakout': 'BR',
      'Meal': 'ME',
      'Special': 'SP',
      'Workshop': 'WS',
      'Networking': 'NW',
      'Poster': 'PO',
      'Break': 'BK'
    };

    function generateSubcodes() {
      const out = {};
      const groups = {};
      sessions.forEach(s => {
        const type = s.type || 'Unknown';
        if (!groups[type]) groups[type] = [];
        groups[type].push(s);
      });

      for (const [type, arr] of Object.entries(groups)) {
        arr.sort((a, b) => {
          const dateCompare = a.date.localeCompare(b.date);
          if (dateCompare !== 0) return dateCompare;
          const timeCompare = a.start.localeCompare(b.start);
          if (timeCompare !== 0) return timeCompare;
          return a.title.localeCompare(b.title);
        });

        const pref = LABEL_PREFIX[type] || (type || 'XX').split(/\s+/).map(w => w[0]).join('').toUpperCase().slice(0, 2) || 'XX';
        arr.forEach((s, i) => {
          out[s.id] = `${pref}${String(i + 1).padStart(2, '0')}`;
        });
      }
      return out;
    }

    const SUBCODES = generateSubcodes();

    function formatTime(time, includeEST = false) {
      const [hours, minutes] = time.split(':');
      const h = parseInt(hours);
      const ampm = h >= 12 ? 'PM' : 'AM';
      const h12 = h % 12 || 12;
      const formatted = `${h12}:${minutes} ${ampm}`;
      return includeEST ? `${formatted} (EST)` : formatted;
    }

    function formatFullDate(dateString) {
      const [year, month, day] = dateString.split('-').map(Number);
      const date = new Date(year, month - 1, day);
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      return date.toLocaleDateString('en-US', options);
    }

    // Speaker photos - Add photo URLs here as you get them
    // Format: "Speaker Name": "https://yourwebsite.com/path/to/photo.jpg"
    const SPEAKER_PHOTOS = {
      "Bulat Ziganshin": "https://static.wixstatic.com/media/a339cb_df74ae8b7be84e569791bdf13113e1cc~mv2.jpg",
      "Aparna Oltikar": "https://static.wixstatic.com/media/a339cb_44105c79e3a641e7941afb34c0a1e48f~mv2.png",
      // Add more speaker photos as needed
    };

    // Speaker information - Biography, expertise, etc.
    const SPEAKER_INFO = {
      "Bulat Ziganshin": {
        title: "Global Health Conference Organizer & Moderator",
        biography: "Bulat Ziganshin is a prominent figure in global health education and conference organization. With extensive experience in facilitating international collaborations, Bulat has been instrumental in bringing together diverse voices from around the world to advance global health initiatives. His work focuses on creating inclusive platforms for knowledge exchange, fostering partnerships between institutions, and developing innovative formats for global health conferences that maximize engagement and impact.",
        expertise: [
          "Global Health Conference Organization",
          "International Partnership Development",
          "Educational Program Design",
          "Cross-Cultural Collaboration"
        ]
      },
      "Aparna Oltikar": {
        title: "Conference Coordinator & Moderator",
        biography: "Aparna Oltikar is dedicated to advancing global health education through innovative conference formats and collaborative partnerships.",
        expertise: [
          "Conference Coordination",
          "Global Health Education",
          "Partnership Development"
        ]
      }
      // Add more speakers as needed
    };

    function getSpeakerUrl(name) {
      return `speaker.html?name=${encodeURIComponent(name)}`;
    }

    function avatarHTML(name) {
      const url = SPEAKER_PHOTOS[name];
      const hasBioInfo = SPEAKER_INFO[name] ? true : false;
      const bioUrl = hasBioInfo ? getSpeakerUrl(name) : getSpeakerUrl(name);

      let avatarContent;
      if (url) {
        avatarContent = `<img loading="lazy" referrerpolicy="no-referrer" alt="${name}" src="${url}" onerror="this.parentElement.setAttribute('data-fallback', ''); this.remove();">`;
      } else {
        const initials = name
          .split(/\s+/)
          .slice(0, 2)
          .map(w => w[0])
          .join('')
          .toUpperCase();
        avatarContent = initials;
      }

      // Always create a link to speaker page
      return `<a href="${bioUrl}" class="avatar" aria-label="${name}" title="${name}" ${!url ? 'data-fallback' : ''}>${avatarContent}</a>`;
    }

    // Get session ID from URL
    const urlParams = new URLSearchParams(window.location.search);
    const sessionId = urlParams.get('id');

    // Find the session - first check top-level sessions, then sub-sessions
    let session = sessions.find(s => s.id === sessionId);
    let subSession = null;
    let parentSession = null;

    // If not found in top-level, search sub-sessions
    if (!session) {
      for (const s of sessions) {
        if (s.subSessions) {
          subSession = s.subSessions.find(sub => sub.id === sessionId);
          if (subSession) {
            parentSession = s;
            break;
          }
        }
      }
    }

    // Render the page
    const contentDiv = document.getElementById('sessionContent');

    if (!session && !subSession) {
      contentDiv.innerHTML = `
        <div class="error-message">
          <h2>Session Not Found</h2>
          <p>The session you're looking for doesn't exist.</p>
          <p><a href="index.html">Return to schedule</a></p>
        </div>
      `;
      document.title = 'Session Not Found';
    } else {
      // If we have a sub-session, render it with parent context
      if (subSession && parentSession) {
        // Calculate time for sub-session
        let timeHTML = '';
        let subStartTime = '';
        let subEndTime = '';
        const subIndex = parentSession.subSessions.findIndex(sub => sub.id === subSession.id);

        if (parentSession.start && subSession.duration) {
          const durationMatch = subSession.duration.match(/(\d+)/);
          if (durationMatch) {
            const minutes = parseInt(durationMatch[1]);
            const [parentHours, parentMinutes] = parentSession.start.split(':').map(Number);
            let cumulativeMinutes = subIndex * minutes;
            let subStartHours = parentHours + Math.floor((parentMinutes + cumulativeMinutes) / 60);
            let subStartMinutes = (parentMinutes + cumulativeMinutes) % 60;
            let subEndMinutes = subStartMinutes + minutes;
            let subEndHours = subStartHours + Math.floor(subEndMinutes / 60);
            subEndMinutes = subEndMinutes % 60;

            const formatSubTime = (hours, mins) => {
              const ampm = hours >= 12 ? 'PM' : 'AM';
              const h12 = hours % 12 || 12;
              return `${h12}:${String(mins).padStart(2, '0')} ${ampm}`;
            };

            subStartTime = formatSubTime(subStartHours, subStartMinutes);
            subEndTime = formatSubTime(subEndHours, subEndMinutes);
            timeHTML = `${subStartTime} – ${subEndTime} (EST)`;
          }
        } else if (subSession.start && subSession.end) {
          subStartTime = formatTime(subSession.start);
          subEndTime = formatTime(subSession.end);
          timeHTML = `${subStartTime} – ${subEndTime} (EST)`;
        }

        // Generate avatar for presenter
        const presenterAvatar = avatarHTML(subSession.presenter);
        const presenterLink = `<a href="${getSpeakerUrl(subSession.presenter)}">${subSession.presenter}</a>`;

        const parentTypeClass = parentSession.type.toLowerCase().replace(/\s+/g, '-');
        const parentSubcode = SUBCODES[parentSession.id] ? `<span class="subcode">${SUBCODES[parentSession.id]}</span>` : '';

        contentDiv.innerHTML = `
          <div class="session-header">
            <span class="session-badge ${parentTypeClass}">${parentSession.type}${parentSubcode}</span>
            <h1>${subSession.title}</h1>
            <p class="session-subtitle" style="font-size: 1rem; color: var(--text-light); margin-top: 8px;">
              Part of: <a href="session.html?id=${parentSession.id}" style="color: var(--primary); text-decoration: underline;">${parentSession.title}</a>
            </p>
            
            <div class="session-meta">
              <div class="meta-item">
                <span class="meta-label">Date</span>
                <span class="meta-value">${formatFullDate(parentSession.date)}</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">Time</span>
                <span class="meta-value">${timeHTML}</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">Room</span>
                <span class="meta-value">${parentSession.room || 'TBD'}</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">Duration</span>
                <span class="meta-value">${subSession.duration || 'TBD'}</span>
              </div>
            </div>
          </div>

          <div class="session-content">
            ${presenterAvatar ? `<div class="avatars" aria-label="Presenter">${presenterAvatar}</div>` : ''}
            
            <div class="content-section">
              <h2>Presenter</h2>
              <ul class="people-list">
                <li>${presenterLink}</li>
              </ul>
            </div>

            ${subSession.description ? `
              <div class="content-section">
                <h2>Description</h2>
                <p>${subSession.description}</p>
              </div>
            ` : ''}
          </div>
        `;

        document.title = `${subSession.title} - Session Details`;
      } else {
        // Regular session rendering
        const typeClass = session.type.toLowerCase().replace(/\s+/g, '-');
        const subcode = SUBCODES[session.id] ? `<span class="subcode">${SUBCODES[session.id]}</span>` : '';

        // Extract people for avatars
        const people = [
          ...(session.moderator ? session.moderator.split(',').map(x => x.trim()).filter(x => x && x !== '—') : []),
          ...(session.speakers || []).filter(x => x && x !== '—')
        ].filter((v, i, a) => a.indexOf(v) === i);

        const avatarsHTML = people.length > 0
          ? `<div class="avatars" aria-label="Speakers and Moderators">${people.map(avatarHTML).join('')}</div>`
          : '';

        const moderatorsList = session.moderator
          ? session.moderator.split(',').map(m => m.trim()).filter(m => m && m !== '—')
            .map(m => `<li><a href="${getSpeakerUrl(m)}">${m}</a></li>`).join('')
          : '';

        const speakersList = session.speakers && session.speakers.length > 0
          ? session.speakers.filter(s => s && s !== '—')
            .map(s => `<li><a href="${getSpeakerUrl(s)}">${s}</a></li>`).join('')
          : '';

        contentDiv.innerHTML = `
          <div class="session-header">
            <span class="session-badge ${typeClass}">${session.type}${subcode}</span>
            <h1>${session.title}</h1>
            ${session.subtitle ? `<p class="session-subtitle">${session.subtitle}</p>` : ''}
            
            <div class="session-meta">
              <div class="meta-item">
                <span class="meta-label">Date</span>
                <span class="meta-value">${formatFullDate(session.date)}</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">Time</span>
                <span class="meta-value">${formatTime(session.start)} – ${formatTime(session.end)} (EST)</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">Room</span>
                <span class="meta-value">${session.room || 'TBD'}</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">Session ID</span>
                <span class="meta-value">${SUBCODES[session.id] || session.id}</span>
              </div>
            </div>
          </div>

          <div class="session-content">
            ${avatarsHTML}
            
            ${session.moderator ? `
              <div class="content-section">
                <h2>Moderator${session.moderator.includes(',') ? 's' : ''}</h2>
                <ul class="people-list">${moderatorsList}</ul>
              </div>
            ` : ''}

            ${session.speakers && session.speakers.length > 0 ? `
              <div class="content-section">
                <h2>Speakers</h2>
                <ul class="people-list">${speakersList}</ul>
              </div>
            ` : ''}

            ${session.note ? `
              <div class="content-section">
                <h2>Additional Information</h2>
                <p><em>${session.note}</em></p>
              </div>
            ` : ''}

          ${session.subSessions && session.subSessions.length > 0 ? `
            <div class="content-section sub-sessions-section">
              <h2>Sub-Presentations (${session.subSessions.length})</h2>
              ${session.subSessions.map((subSession, index) => {
          // Calculate time slot if parent session has time and duration
          let timeHTML = '';
          if (session.start && subSession.duration) {
            const durationMatch = subSession.duration.match(/(\d+)/);
            if (durationMatch) {
              const minutes = parseInt(durationMatch[1]);
              const [parentHours, parentMinutes] = session.start.split(':').map(Number);
              let cumulativeMinutes = index * minutes;
              let subStartHours = parentHours + Math.floor((parentMinutes + cumulativeMinutes) / 60);
              let subStartMinutes = (parentMinutes + cumulativeMinutes) % 60;
              let subEndMinutes = subStartMinutes + minutes;
              let subEndHours = subStartHours + Math.floor(subEndMinutes / 60);
              subEndMinutes = subEndMinutes % 60;

              const formatSubTime = (hours, mins) => {
                const ampm = hours >= 12 ? 'PM' : 'AM';
                const h12 = hours % 12 || 12;
                return `${h12}:${String(mins).padStart(2, '0')} ${ampm}`;
              };

              timeHTML = `<div class="sub-session-item-time">${formatSubTime(subStartHours, subStartMinutes)} – ${formatSubTime(subEndHours, subEndMinutes)}</div>`;
            }
          } else if (subSession.start && subSession.end) {
            timeHTML = `<div class="sub-session-item-time">${formatTime(subSession.start)} – ${formatTime(subSession.end)}</div>`;
          }

          const presenterLink = SPEAKER_INFO[subSession.presenter]
            ? `<a href="${getSpeakerUrl(subSession.presenter)}">${subSession.presenter}</a>`
            : subSession.presenter;

          return `
                  <a href="session.html?id=${subSession.id}" class="sub-session-item" style="text-decoration: none; color: inherit; display: block;">
                    <span class="sub-session-item-number">${index + 1}</span>
                    <div class="sub-session-item-content">
                      <div class="sub-session-item-title">${subSession.title}</div>
                      <div class="sub-session-item-presenter">
                        <strong>Presenter:</strong> ${presenterLink}
                      </div>
                      ${timeHTML}
                    </div>
                  </a>
                `;
        }).join('')}
            </div>
          ` : ''}
        </div>
      `;

        document.title = `${session.title} - Session Details`;
      }
    }
  </script>
</body>

</html>